generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  userId         String      @id // same as zid
  createdAt      DateTime    @default(now())
  lastLogin      DateTime?   @default(now())
  firstname      String?
  lastname       String?
  email          String
  profileURL     String?
  timetable      Timetable[]
  settings       Settings?
  friends        User[]      @relation("UserFriends")
  friendRequests User[]      @relation("UserFriends")
  groups         Group[]     @relation("GroupMember")
}

model Group {
  id             String      @id
  name           String
  description    String?
  isPublic       Boolean
  timetables     Timetable[] @relation("GroupTimetable")
  members        User[]      @relation("GroupMember")
}

model Event {
  id          String  @id
  name        String
  location    String?
  description String?
  colour      String  @default("#1F7E8C")

  // Event Time
  day         String
  start       DateTime
  end         DateTime
  timetable   Timetable? @relation(fields: [timetableId], references: [id])
  timetableId String?
  groupId     String?   // Added to link an event to a group
}

model Class {
  id          String     @unique
  classType   String     // e.g. Lecture, Tutorial, Laboratory, etc.
  courseName  String?
  Timetable   Timetable? @relation(fields: [timetableId], references: [id], onDelete: Cascade)
  timetableId String?
}

model Timetable {
  id              String   @id @unique
  name            String
  selectedCourses String[]
  selectedClasses Class[]
  createdEvents   Event[]
  user            User     @relation(fields: [userId], references: [userId], onDelete: Cascade)
  userId          String
  groups          Group[]  @relation("GroupTimetable")
}

model Settings {
  userId                   String  @unique
  user                     User    @relation(fields: [userId], references: [userId])
  is12HourMode             Boolean
  isDarkMode               Boolean
  isSquareEdges            Boolean
  isHideFullClasses        Boolean
  isDefaultUnscheduled     Boolean
  isHideClassInfo          Boolean
  isSortAlphabetic         Boolean
  isShowOnlyOpenClasses    Boolean
  isHideExamClasses        Boolean
  isConvertToLocalTimezone Boolean
}

model Session {
  id        String   @id
  sid       String   @unique
  data      String   @db.Text // MediumText may be needed for MySql
  expiresAt DateTime
}
